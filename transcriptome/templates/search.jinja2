{% extends "base.jinja2" %}

{% if account_status == 'active' %}
  {% block logout %}
    {% include "logout_form.jinja2" %}
  {% endblock logout %}

  {% block search %}
    {% include "transcript_search_form.jinja2"  %}
  {% endblock search %}

  <div>
  {% block content %}
    <div>
      Search results: {{ search_count }} <br>
      Page: {{ pager.current_page }} / {{ pager.last_page }}
    </div>
    {% if pager.first_page == pager.last_page %}
      First
      Previous
      Next
      Last
    {% elif pager.current_page == 1 %}
      First
      Previous
      <a href="/bdorseq/search/?page={{ pager.next_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Next<a>
      <a href="/bdorseq/search/?page={{ pager.last_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Last<a>
    {% elif pager.current_page == pager.last_page %}
      <a href="/bdorseq/search/?page={{ pager.first_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">First<a>
      <a href="/bdorseq/search/?page={{ pager.previous_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Previous<a>
      Next
      Last
    {% else %}
      <a href="/bdorseq/search/?page={{ pager.first_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">First<a>
      <a href="/bdorseq/search/?page={{ pager.previous_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Previous<a>
      <a href="/bdorseq/search/?page={{ pager.next_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Next<a>
      <a href="/bdorseq/search/?page={{ pager.last_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Last<a>
    {% endif %}

    {% block export_form %}
      <form name="export_form", action="/bdorseq/export/" method="post">
        <input type="hidden" name="seqname", value="{{ getparam.seqname }}" />
        <input type="hidden" name="line", value="{{ getparam.line }}" />
        <input type="hidden" name="seq", value="{{ getparam.seq }}" />
        <input type="hidden" name="refacc", value="{{ getparam.refacc }}" />
        <input type="hidden" name="refdes", value="{{ getparam.refdes }}" />
        <input type="submit", name="export_fasta", value="Download FASTA" />
        <input type="submit", name="export_blast", value="Download BLAST" />
        <input type="submit", name="export_rpkm", value="Download Gene Expression" />
        <table>
          <thead>
            <tr>
              <th>{# <input type="checkbox" onClick="toggle('export_form" /> #}</th>
              <th>Transcript Name</th>
              <th>Length (bp)</th>
              <th>Reference Acc</th>
              <th>Reference Description</th>
            </tr>
          </thead>

          <tbody>
            {% for query in transcript_subset %}
              <tr>
                <td><input type="checkbox", name={{ '_export_' ~ query.id }}, value={{ query.id }} /></td>
                <td>{{ query.seqname }}</td>
                <td>{{ query.seq|length }}</td>
                {% if query.homology_set.all().count() > 0  %}
                  <td>{{ query.homology_set.all().0.hit_name }}</td>
                  <td>{{ query.homology_set.all().0.hit_description }}</td>
                {% else %}
                  <td></td>
                  <td></td>
                {% endif %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </form>
    {% endblock export_form %}
  {% endblock content %}
  </div>

{% else %}
  {% block login %}
  {% if account_status == 'expired' %}
    <p>Please login to use database.</p>
    {% include "login_form.jinja2" %}

  {% elif account_status == 'invalid' %}
    <p>Invalid user!</p>
    {% include "login_form.jinja2" %}

  {% endif %}
  {% endblock login %}
{% endif %}
