{% extends "base.jinja2" %}

{% if account_status == 'active' %}
  {% block logout %}
    {% include "logout_form.jinja2" %}
  {% endblock logout %}

  {% block search %}
    {% include "transcript_search_form.jinja2"  %}
  {% endblock search %}

  <div>
  {% block content %}
    <div>
      Search results: {{ search_count }}
    </div>
    {% if pager.current_page == 1 %}
      First
      <a href="/bdorseq/search/?page={{ pager.previous_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Previous<a>
      <a href="/bdorseq/search/?page={{ pager.next_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Next<a>
      <a href="/bdorseq/search/?page={{ pager.last_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Last<a>
    {% elif pager.current_page == pager.last_page %}
      <a href="/bdorseq/search/?page={{ pager.first_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">First<a>
      <a href="/bdorseq/search/?page={{ pager.previous_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Previous<a>
      <a href="/bdorseq/search/?page={{ pager.next_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Next<a>
      Last
    {% else %}
      <a href="/bdorseq/search/?page={{ pager.first_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">First<a>
      <a href="/bdorseq/search/?page={{ pager.previous_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Previous<a>
      <a href="/bdorseq/search/?page={{ pager.next_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Next<a>
      <a href="/bdorseq/search/?page={{ pager.last_page }}&line={{ getparam.line }}&seqname={{ getparam.seqname }}&refacc={{ getparam.refacc }}&refdes={{ getparam.refdes }}&seq={{ getparam.seq }}&items_per_page={{ getparam.items_per_page }}">Last<a>
    {% endif %}

    {% block export_form %}
      <form name="export_form", action="/bdorseq/export/" method="post">
        <input type="hidden" name="seqname", value={{ getparam.seqname|safe }} />
        <input type="hidden" name="line", value={{ getparam.line|safe }} />
        <input type="hidden" name="seq", value={{ getparam.seq|safe }} />
        <input type="hidden" name="refacc", value={{ getparam.refacc|safe }} />
        <input type="hidden" name="refdes", value={{ getparam.refdes|safe }} />
        <input type="submit", name="export_fasta", value="Export to FASTA file" />
        <input type="submit", name="export_tsv", value="Export to TSV file" />
        <table>
          <thead>
            <tr>
              <th>{# <input type="checkbox" onClick="toggle('export_form" /> #}</th>
              <th>Transcript Name</th>
              <th>Length (bp)</th>
              <th>Reference Acc</th>
              <th>Reference Description</th>
            </tr>
          </thead>

          <tbody>
            {% for query in transcript_subset %}
              <tr>
                <td><input type="checkbox", name={{ '_export_' ~ query.id }}, value={{ query.id }} /></td>
                <td>{{ query.seqname }}</td>
                <td>{{ query.homology.query_length }}</td>
                <td>{{ query.homology.hit_name }}</td>
                <td>{{ query.homology.hit_description }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </form>
    {% endblock export_form %}
  {% endblock content %}
  </div>

{% else %}
  {% block login %}
  {% if account_status == 'expired' %}
    <p>Please login to use database.</p>
    {% include "login_form.jinja2" %}

  {% elif account_status == 'invalid' %}
    <p>Invalid user!</p>
    {% include "login_form.jinja2" %}

  {% endif %}
  {% endblock login %}
{% endif %}
